import{d as G,o as L,c as a,a as t,w as A,v as B,F as d,r as m,b as f,e as c,f as p,g as E,h as M,i as l,t as u,j as $,k as N,l as S,_ as Q}from"./index-BdZg5HdZ.js";import{b}from"./beads-B4Vxsoum.js";const F={class:"overview-page"},z={class:"row-between overview-toolbar"},H={class:"row overview-filter-row"},J=["value"],K={class:"grid-3"},W=["onDragstart"],X=["href"],Y=["onClick"],Z={class:"row-between item-meta"},nn={class:"badge"},en=["src"],tn={class:"row item-stats"},on=["value","onChange"],sn=["value","onChange"],an={class:"row-between item-actions"},ln=["onClick"],rn=["onDragstart"],un=["href"],dn=["onClick"],cn={class:"row-between item-meta"},vn={class:"badge"},pn=["src"],gn={class:"row item-stats"},fn=["value","onChange"],bn=["value","onChange"],yn={class:"row-between item-actions"},_n=["onClick"],kn=["onDragstart"],wn=["href"],Cn=["onClick"],Dn={class:"row-between item-meta"},mn={class:"badge"},hn=["src"],jn={class:"row item-stats"},In=["value","onChange"],On=["value","onChange"],Pn={class:"row-between item-actions"},qn=["onClick"],$n=G({__name:"OverviewPage",setup(Nn){const i=p([]),y=p(null),g=p([]),R=p([]),_=p(""),k=p({visible:!1,projectId:0}),h=E(()=>_.value?i.value.filter(o=>(o.tags||[]).includes(_.value)):i.value),j=E(()=>({DONE:h.value.filter(o=>o.status==="DONE"),IN_PROGRESS:h.value.filter(o=>o.status==="IN_PROGRESS"),TODO:h.value.filter(o=>o.status==="TODO")}));async function x(){try{const[o,e]=await Promise.all([b.list(),b.tags()]);i.value=o,R.value=e}catch(o){console.error(o),alert("加载总览失败，请确认桌面版后端服务已启动（或重启应用后重试）")}}function I(o){y.value=o}async function O(o){if(!y.value)return;const e=i.value.find(r=>r.id===y.value);if(e)try{const r=o==="DONE"?e.quantityPlan:e.quantityDone,n=await b.updateStatusAndQty(e.id,{status:o,quantityDone:r,quantityPlan:e.quantityPlan}),s=i.value.findIndex(D=>D.id===n.id);s>=0&&(i.value[s]=n)}catch(r){console.error(r),alert("拖拽更新失败：请检查后端是否启动，或刷新后重试")}finally{y.value=null}}async function v(o,e,r){const n=Number(r.target.value||0);try{const s=await b.updateStatusAndQty(o.id,{status:o.status,quantityDone:e==="done"?n:o.quantityDone,quantityPlan:e==="plan"?n:o.quantityPlan}),D=i.value.findIndex(V=>V.id===s.id);D>=0&&(i.value[D]=s)}catch(s){console.error(s),alert("数量更新失败，请稍后重试")}}async function P(o){k.value={visible:!0,projectId:o}}function w(){k.value={visible:!1,projectId:0}}async function T(){const o=k.value.projectId;if(!o){w();return}try{await b.remove(o),i.value=i.value.filter(e=>e.id!==o)}catch(e){console.error(e),alert("删除失败，请稍后重试")}finally{w()}}function C(o){return g.value.includes(o)}function q(o){C(o)?g.value=g.value.filter(e=>e!==o):g.value=[...g.value,o]}function U(){window.scrollTo({top:0,behavior:"smooth"})}return L(x),(o,e)=>{const r=M("RouterLink");return l(),a(d,null,[t("section",F,[t("div",z,[e[9]||(e[9]=t("h2",{class:"section-title"},"拼豆总览",-1)),t("div",H,[A(t("select",{class:"select filter-select","onUpdate:modelValue":e[0]||(e[0]=n=>_.value=n)},[e[8]||(e[8]=t("option",{value:""},"全部",-1)),(l(!0),a(d,null,m(R.value,n=>(l(),a("option",{key:n,value:n},u(n),9,J))),128))],512),[[B,_.value]]),t("button",{class:"btn refresh-btn",onClick:x},"刷新")])]),t("div",K,[t("div",{class:"kanban-col",onDragover:e[1]||(e[1]=f(()=>{},["prevent"])),onDrop:e[2]||(e[2]=n=>O("DONE"))},[e[13]||(e[13]=t("h3",null,"已拼完",-1)),(l(!0),a(d,null,m(j.value.DONE,n=>(l(),a("div",{key:n.id,class:"kanban-item",draggable:"true",onDragstart:s=>I(n.id)},[n.sourceUrl?(l(),a("a",{key:0,href:n.sourceUrl,target:"_blank",rel:"noopener noreferrer",class:"project-name"},u(n.name),9,X)):(l(),a("strong",{key:1,class:"project-name",onClick:s=>q(n.id)},u(n.name),9,Y)),C(n.id)?c("",!0):(l(),a(d,{key:2},[t("div",Z,[t("span",nn,u(n.tags.join(", ")||"无tag"),1)]),n.patternImage?(l(),a("img",{key:0,src:n.patternImage,class:"project-image"},null,8,en)):c("",!0),t("div",tn,[e[10]||(e[10]=t("label",null,"已拼",-1)),t("input",{class:"input",type:"number",min:"0",value:n.quantityDone,onChange:s=>v(n,"done",s)},null,40,on),e[11]||(e[11]=t("label",null,"计划",-1)),t("input",{class:"input",type:"number",min:"0",value:n.quantityPlan,onChange:s=>v(n,"plan",s)},null,40,sn)]),t("div",an,[$(r,{to:`/detail/${n.id}`},{default:N(()=>[...e[12]||(e[12]=[S("查看详情",-1)])]),_:1},8,["to"]),t("button",{class:"btn warn",onClick:s=>P(n.id)},"删除",8,ln)])],64))],40,W))),128))],32),t("div",{class:"kanban-col",onDragover:e[3]||(e[3]=f(()=>{},["prevent"])),onDrop:e[4]||(e[4]=n=>O("IN_PROGRESS"))},[e[17]||(e[17]=t("h3",null,"正在拼",-1)),(l(!0),a(d,null,m(j.value.IN_PROGRESS,n=>(l(),a("div",{key:n.id,class:"kanban-item",draggable:"true",onDragstart:s=>I(n.id)},[n.sourceUrl?(l(),a("a",{key:0,href:n.sourceUrl,target:"_blank",rel:"noopener noreferrer",class:"project-name"},u(n.name),9,un)):(l(),a("strong",{key:1,class:"project-name",onClick:s=>q(n.id)},u(n.name),9,dn)),C(n.id)?c("",!0):(l(),a(d,{key:2},[t("div",cn,[t("span",vn,u(n.tags.join(", ")||"无tag"),1)]),n.patternImage?(l(),a("img",{key:0,src:n.patternImage,class:"project-image"},null,8,pn)):c("",!0),t("div",gn,[e[14]||(e[14]=t("label",null,"已拼",-1)),t("input",{class:"input",type:"number",min:"0",value:n.quantityDone,onChange:s=>v(n,"done",s)},null,40,fn),e[15]||(e[15]=t("label",null,"计划",-1)),t("input",{class:"input",type:"number",min:"0",value:n.quantityPlan,onChange:s=>v(n,"plan",s)},null,40,bn)]),t("div",yn,[$(r,{to:`/detail/${n.id}`},{default:N(()=>[...e[16]||(e[16]=[S("查看详情",-1)])]),_:1},8,["to"]),t("button",{class:"btn warn",onClick:s=>P(n.id)},"删除",8,_n)])],64))],40,rn))),128))],32),t("div",{class:"kanban-col",onDragover:e[5]||(e[5]=f(()=>{},["prevent"])),onDrop:e[6]||(e[6]=n=>O("TODO"))},[e[21]||(e[21]=t("h3",null,"将要拼",-1)),(l(!0),a(d,null,m(j.value.TODO,n=>(l(),a("div",{key:n.id,class:"kanban-item",draggable:"true",onDragstart:s=>I(n.id)},[n.sourceUrl?(l(),a("a",{key:0,href:n.sourceUrl,target:"_blank",rel:"noopener noreferrer",class:"project-name"},u(n.name),9,wn)):(l(),a("strong",{key:1,class:"project-name",onClick:s=>q(n.id)},u(n.name),9,Cn)),C(n.id)?c("",!0):(l(),a(d,{key:2},[t("div",Dn,[t("span",mn,u(n.tags.join(", ")||"无tag"),1)]),n.patternImage?(l(),a("img",{key:0,src:n.patternImage,class:"project-image"},null,8,hn)):c("",!0),t("div",jn,[e[18]||(e[18]=t("label",null,"已拼",-1)),t("input",{class:"input",type:"number",min:"0",value:n.quantityDone,onChange:s=>v(n,"done",s)},null,40,In),e[19]||(e[19]=t("label",null,"计划",-1)),t("input",{class:"input",type:"number",min:"0",value:n.quantityPlan,onChange:s=>v(n,"plan",s)},null,40,On)]),t("div",Pn,[$(r,{to:`/detail/${n.id}`},{default:N(()=>[...e[20]||(e[20]=[S("查看详情",-1)])]),_:1},8,["to"]),t("button",{class:"btn warn",onClick:s=>P(n.id)},"删除",8,qn)])],64))],40,kn))),128))],32)]),t("button",{class:"scroll-top-btn",onClick:U},"回到顶部")]),k.value.visible?(l(),a("div",{key:0,class:"modal-mask",onClick:f(w,["self"])},[t("div",{class:"modal-panel confirm-panel",onClick:e[7]||(e[7]=f(()=>{},["stop"]))},[e[22]||(e[22]=t("h3",{class:"confirm-title"},"确认删除",-1)),e[23]||(e[23]=t("p",{class:"confirm-text"},"确认删除这个拼豆项目吗？删除后不可恢复。",-1)),t("div",{class:"row confirm-actions"},[t("button",{class:"btn secondary",onClick:w},"取消"),t("button",{class:"btn warn",onClick:T},"确认删除")])])])):c("",!0)],64)}}}),xn=Q($n,[["__scopeId","data-v-5a661363"]]);export{xn as default};
